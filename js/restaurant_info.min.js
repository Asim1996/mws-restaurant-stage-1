let restaurant;var newMap;let review;navigator.serviceWorker&&navigator.serviceWorker.register("./sw.js").then(function(){console.log("Registration worked!")}).catch(function(){console.log("Registration Failed!")}),document.addEventListener("DOMContentLoaded",e=>{initMap(),document.querySelector(".submit-review").addEventListener("click",addReview),window.addEventListener("online",isOnline),window.addEventListener("offline",isOffline)}),initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoibWV0YWxpbmd1cyIsImEiOiJjamlkMmtveHQwMnlrM3dveTU5MHF4Y3liIn0.uBfa5-js-MdO-UbmNwv6gA",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{const t=document.getElementById("restaurant-name");t.innerHTML=e.name;var n=!(!e.is_favorite||"true"!==e.is_favorite.toString());const r=document.createElement("button");r.setAttribute("role","switch"),r.setAttribute("aria-checked",n),r.id=`${e.id}`,r.classList.add("heart"),n?(r.classList.add("favorite-checked"),r.setAttribute("aria-label",`${e.name} is a favorite restaurant`)):r.setAttribute("aria-label",`${e.name} is not a favorite restaurant`),r.onclick=(t=>{DBHelper.markFavorite(e),r.classList.toggle("favorite-checked"),n=!n,r.setAttribute("aria-checked",n),n?r.setAttribute("aria-label",`${e.name} is a favorite restaurant`):r.setAttribute("aria-label",`${e.name} is not a favorite restaurant`)}),t.append(r),document.getElementById("restaurant-address").innerHTML=e.address;document.getElementById("restaurant-picture");document.querySelector("source").srcset=`/img/${e.id}.webp 800w, /img/${e.id}-600.webp 600w, /img/${e.id}-400.webp 400w`;const a=document.getElementById("restaurant-img");a.className="restaurant-img",a.src=DBHelper.imageUrlForRestaurant(e),a.srcset=`/img/${e.id}.jpg 800w, /img/${e.id}-600.jpg 600w, /img/${e.id}-400.jpg 400w`,document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}});const fillReviewsHTML=()=>{const e=document.getElementById("reviews-container"),t=document.createElement("h3");t.innerHTML="Reviews",e.insertAdjacentElement("afterbegin",t);const n=self.restaurant.id;DBHelper.fetchRestaurantReviewsById(n).then(n=>{if(!n){const n=document.createElement("p");return n.innerHTML="No reviews yet!",void e.insertAfter(n,t)}const r=document.getElementById("reviews-list");n.forEach(e=>{r.appendChild(createReviewHTML(e))})})};createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=new Date(e.createdAt).toDateString(),t.appendChild(r);const a=document.createElement("span");a.className=`star-${e.rating}`,a.setAttribute("aria-hidden","true"),a.setAttribute("title","User Rating");const i=document.createElement("span");i.className="visuallyhidden",i.innerHTML=`Rating ${e.rating}`,t.appendChild(a),t.appendChild(i);const o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t});const addReview=e=>{const t=document.querySelector(".name"),n=document.querySelector(".rating"),r=document.querySelector(".comments"),a={restaurant_id:self.restaurant.id,name:t.value,rating:n.value,comments:r.value,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};console.log("payload",a),document.getElementById("reviews-list").appendChild(createReviewHTML(a)),DBHelper.postReviewToDB(a),resetReviewForm(t,n,r)},resetReviewForm=(e,t,n)=>{e.value="",t.value="",n.value="Enter Comments"},syncReviewsWithServer=()=>{Promise.all(window.reviewsToBeSynced.map(e=>{DBHelper.postReviewToServer(e)})).then(e=>{alert("Background Sync for reviews completed"),window.reviewsToBeSynced.length=0}).catch(e=>{window.reviewsToBeSynced.length=0})},isOnline=e=>{alert("Application Is Now Online, Sync Will Continue."),Promise.all(window.reviewsToBeSynced.map(e=>{DBHelper.postReviewToServer(e)})).then(e=>{alert("Background Sync for reviews completed"),window.reviewsToBeSynced.length=0}).catch(e=>{window.reviewsToBeSynced.length=0})},isOffline=e=>{alert("Application Is Offline, Data will be saved for background sync ")};function toggleForm(){var e=document.getElementById("review-form"),t=document.getElementById("add-review");"none"==e.style.display||""==e.style.display?(e.style.display="block",t.style.marginBottom="1rem"):(e.style.display="none",t.style.marginBottom="5rem")}fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});