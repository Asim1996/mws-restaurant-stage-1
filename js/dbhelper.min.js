class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static openDatabase(t){if("indexedDB"in window)return idb.open("restaurant-db",1,function(t){t.createObjectStore("restaurant",{keyPath:"id",autoIncrement:!0})});console.log("This browser doesn't support IndexedDB")}static updateDB(t,e){return e.then(function(e){var n=e.transaction("restaurant","readwrite"),r=n.objectStore("restaurant");t.forEach(function(t){r.put(t),n.complete})})}static fetchfromDb(t){return t.then(function(t){if(!t)return;return t.transaction("restaurant").objectStore("restaurant").getAll()})}static fetchRestaurants(t){const e=DBHelper.openDatabase();DBHelper.fetchfromDb(e).then(n=>{n.length>0?t(null,n):fetch(DBHelper.DATABASE_URL).then(t=>{if(!t.ok)throw t.statusText;return t.json()}).then(n=>{DBHelper.updateDB(n,e),t(null,n)}).catch(e=>{t(e,null)})})}static fetchRestaurantById(t,e){DBHelper.fetchRestaurants((n,r)=>{if(n)e(n,null);else{const n=r.find(e=>e.id==t);n?e(null,n):e("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((n,r)=>{if(n)e(n,null);else{const n=r.filter(e=>e.cuisine_type==t);e(null,n)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((n,r)=>{if(n)e(n,null);else{const n=r.filter(e=>e.neighborhood==t);e(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,n){DBHelper.fetchRestaurants((r,a)=>{if(r)n(r,null);else{let r=a;"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),n(null,r)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,n)=>{if(e)t(e,null);else{const e=n.map((t,e)=>n[e].neighborhood),r=e.filter((t,n)=>e.indexOf(t)==n);t(null,r)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,n)=>{if(e)t(e,null);else{const e=n.map((t,e)=>n[e].cuisine_type),r=e.filter((t,n)=>e.indexOf(t)==n);t(null,r)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`/img/${t.photograph}`}static mapMarkerForRestaurant(t,e){const n=new L.marker([t.latlng.lat,t.latlng.lng],{title:t.name,alt:t.name,url:DBHelper.urlForRestaurant(t)});return n.addTo(newMap),n}}